<span id="variable-description-box">
  <button
    type="button"
    class="btn btn-default dropdown-toggle expand-btn"
    data-toggle="collapse"
    href="#collapseVariableDescription"
    role="button"
    aria-expanded="false"
  >
    Show Variable Description<span class="caret"></span>
  </button>
  <div class="collapse" id="collapseVariableDescription">
    <div class="card card-body" style="padding: 0.15rem !important">
      <div style="overflow-y: scroll; height: 300px">
        <span id="ph-variable-description"></span>
        <span id="spinner-ph-variable-description" class="loader-spinner"></span>
        <style>
         #spinner-ph-variable-description { width: 20px; height: 20px; padding-bottom: 10px; border: 2px solid rgb(133, 133, 133);
            border-bottom-color: transparent; border-radius: 50%; display: inline-block;
            box-sizing: border-box; animation: rotation 1s linear infinite;}
            @keyframes rotation {0% {transform: rotate(0deg);} 100% {transform: rotate(360deg);}} 
        </style>
      </div>
    </div>
  </div>
  <br />
</span>

<script defer>
var randID = makeid(10);

async function renderVariableDescription() {
  // Wait for data to be loaded
  while (!isDataSaved()) {
    await new Promise(resolve => setTimeout(resolve, 1000));
  }

  const conceptDOI = "{{.Get `doi`}}";
  
  try {
    const tableData = await getMetadataFile(conceptDOI, "metadata/variable_description.json");
    // If it's already parsed (from JSON), use it; otherwise parse it
    const tableDataObj = typeof tableData === 'object' ? tableData : JSON.parse(tableData);
    
    const keys = Object.keys(tableDataObj);
    const values = Object.values(tableDataObj);
    
    const table = document.createElement("table");
    const headerRow = table.insertRow(-1);
    const headerVar = document.createElement("th");
    headerVar.innerHTML = "Variable";
    const headerDesc = document.createElement("th");
    headerDesc.innerHTML = "Description";
    headerRow.appendChild(headerVar);
    headerRow.appendChild(headerDesc);
    
    for (let i = 0; i < keys.length; i++) {
      const row = table.insertRow(-1);
      row.insertCell(-1).innerHTML = "<code>" + keys[i] + "</code>";
      row.insertCell(-1).innerHTML = values[i];
    }
    
    table.style.fontSize = "90%";
    
    // Hide spinner
    document.getElementById("spinner-ph-variable-description").style.display = "none";
    
    // Update content
    const div = document.getElementById("ph-variable-description");
    div.id = div.id + "-" + randID;
    div.appendChild(table);
  } catch (error) {
    console.error("Error loading variable description:", error);
    document.getElementById("spinner-ph-variable-description").style.display = "none";
    const div = document.getElementById("ph-variable-description");
    div.id = div.id + "-" + randID;
    div.innerHTML = "<em>Error loading variable description</em>";
  }
}

renderVariableDescription();
</script>
