<span id="ph-last-search"></span>

<span id="spinner-ph-last-search" class="loader-spinner"></span>
<style>
.loader-spinner { width: 20px; height: 20px; margin-bottom: -5px; border: 2px solid rgb(133, 133, 133);
    border-bottom-color: transparent; border-radius: 50%; display: inline-block;
    box-sizing: border-box; animation: rotation 1s linear infinite;}
    @keyframes rotation {0% {transform: rotate(0deg);} 100% {transform: rotate(360deg);}} 
</style>

<script defer>
var randID = makeid(10);

async function renderLastSearch() {
  // Wait for data to be loaded
  while (!isDataSaved()) {
    await new Promise(resolve => setTimeout(resolve, 1000));
  }

  const conceptDOI = "{{.Get `doi`}}";
  
  try {
    const content = await getMetadataFile(conceptDOI, "metadata/last_search.txt");
    
    const months = [
      "January", "February", "March", "April", "May", "June",
      "July", "August", "September", "October", "November", "December"
    ];
    
    let dateStr = new String(content);
    if (dateStr.length > 10) {
      dateStr = dateStr.substring(0, 10);
    }
    
    const date = new Date(dateStr);
    const month = months[date.getMonth()];
    const year = date.getFullYear();
    const day = date.getDate();
    const modDate = document.createTextNode(month + " " + day + ", " + year);
    
    // Hide spinner
    document.getElementById("spinner-ph-last-search").style.display = "none";
    
    // Update content
    const div = document.getElementById("ph-last-search");
    div.id = div.id + "-" + randID;
    div.appendChild(modDate);
  } catch (error) {
    console.error("Error loading last search:", error);
    document.getElementById("spinner-ph-last-search").style.display = "none";
    const div = document.getElementById("ph-last-search");
    div.id = div.id + "-" + randID;
    div.innerHTML = "<em>Error loading last search date</em>";
  }
}

renderLastSearch();
</script>
