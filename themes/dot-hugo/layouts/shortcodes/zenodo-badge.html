<span id="ph-badge"></span>

<span id="spinner-ph-badge" class="loader-spinner"></span>
<style>
.loader-spinner { width: 20px; height: 20px; margin-bottom: -5px; border: 2px solid rgb(133, 133, 133);
    border-bottom-color: transparent; border-radius: 50%; display: inline-block;
    box-sizing: border-box; animation: rotation 1s linear infinite;}
    @keyframes rotation {0% {transform: rotate(0deg);} 100% {transform: rotate(360deg);}} 
</style>

<script defer>
  var randID = makeid(10);

  // main rendering function
  async function renderBadge() {

    while (!isDataSaved()) {
      await new Promise(resolve => setTimeout(resolve, 1000)); // Adjust the delay as needed
    }

    /*            
      render element
    */

    // Retrieve from session storage
    var post = JSON.parse(sessionStorage.getItem("apiResponse"));
    // loop through all elements
    var firstItem = true;
    for (let i = 0; i < post.length; i++) {
      var searchDOI = post[i].conceptdoi?.toString() || "";
      searchDOI = JSON.stringify(searchDOI);
      var inputDOI = JSON.stringify("{{.Get `doi`}}");

      // if DOI fits, do operation
      if (searchDOI === inputDOI) {
        if (firstItem === true) {
          var badgeUrl =
            "https://img.shields.io/badge/DOI-" + post[i].conceptdoi + "-blue";
          var href = post[i].links.parent_doi;
          var img = document.createElement("img");
          var link = document.createElement("a");
          link.setAttribute("href", href);
          link.setAttribute("target", "blank");
          img.setAttribute("src", badgeUrl);
          document.getElementById('spinner-ph-badge').style.display = 'none';
          var div = document.getElementById("ph-badge");
          div.id = div.id + "-" + randID;
          img.style.maxWidth = "unset !important";
          img.style.height = "unset !important";
          img.style.padding = 0;
          img.style.margin = 0;
          img.style.display = "inline";
          link.appendChild(img);
          div.appendChild(link);
          firstItem = false;
        }
      }
    }
  }

  // execute
  renderBadge();
</script>
