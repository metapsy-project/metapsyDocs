<span id="references-box">
  <button
    type="button"
    class="btn btn-default dropdown-toggle expand-btn"
    data-toggle="collapse"
    href="#collapseReferences"
    role="button"
    aria-expanded="false"
  >
    Show References<span class="caret"></span>
  </button>
  <div class="collapse" id="collapseReferences">
    <div class="card card-body">
      <span id="ph-references"></span>
      <span id="spinner-ph-references" class="loader-spinner" style="margin-left: 5px;"></span>
      <style>
        #spinner-ph-references { width: 20px; height: 20px; margin-bottom: 5px; padding-bottom: 5px; border: 2px solid rgb(133, 133, 133);
          border-bottom-color: transparent; border-radius: 50%; display: inline-block;
          box-sizing: border-box; animation: rotation 1s linear infinite;}
          @keyframes rotation {0% {transform: rotate(0deg);} 100% {transform: rotate(360deg);}} 
      </style>
    </div>
  </div>
  <br />
</span>

<script defer>
  var randID = makeid(10);

  // main rendering function
  async function renderReferences() {

    while (!isDataSaved()) {
      await new Promise(resolve => setTimeout(resolve, 1000)); // Adjust the delay as needed
    }

    /*            
      render element
    */
   // Retrieve from session storage
   var post = JSON.parse(sessionStorage.getItem("apiResponse"));
    // loop through all elements
    var first = true;
    for (let i = 0; i < post.length; i++) {
      var searchDOI = post[i].conceptdoi?.toString() || "";
      searchDOI = JSON.stringify(searchDOI);
      var inputDOI = JSON.stringify("{{.Get `doi`}}");

      if (searchDOI === inputDOI) {
        if (first === true) {
          // get references JSON
          var ghLink = post[i].metadata.related_identifiers[0].identifier;
          var repoName = ghLink.split("/")[4];
          var repoVersion = ghLink.split("/")[6];
          var readLink =
            "https://raw.githubusercontent.com/metapsy-project/" +
            repoName +
            "/" +
            repoVersion +
            "/metadata/" +
            "references" +
            ".json";
          fetch(readLink)
            .then((d) => d.text())
            .then((d) => {
              d = JSON.parse(d);
              var keys = Object.keys(d);
              var html =
                " <div " +
                "style='background-color: var(--body-color);" +
                " padding: 20px 20px 20px 20px;" +
                "overflow-y: scroll; height:300px;'><ul " +
                "style='font-size: 90% !important;'>";
              for (let j = 0; j < keys.length; j++) {
                var addHtml =
                  "<li><strong>" +
                  String(keys[j]) +
                  ":</strong> " +
                  String(d[keys[j]]) +
                  "</li>";
                html = html + addHtml;
              }
              html = html + "</ul></div>";
              document.getElementById('spinner-ph-references').style.display = 'none';
              var div = document.getElementById("ph-references");
              div.id = randID;
              div.innerHTML = html;
            });
          first = false;
        }
      }
    }
  }

  // execute
  renderReferences();
</script>